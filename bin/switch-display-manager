#!/usr/bin/env bash
DISPLAY_MANAGER="$1"
SUPPORTED_DISPLAY_MANAGERS=("greetd" "sddm")

log_error() {
    echo -e "\n\x1b[33;1m$@...\x1b[0m\n" >&2
}

if test "$DISPLAY_MANAGER" = ""; then
    log_error "No display manager provided"

    exit 1
fi

current_display_manager="$(
    systemctl status display-manager --no-pager --plain --quiet \
        | grep -oP '(?<=\x{25cf} )(.+)(?=\.service.+)'
)"

case $DISPLAY_MANAGER in
    greetd | sddm)
        sudo systemctl disable --now $current_display_manager \
            && sudo systemctl enable --now $DISPLAY_MANAGER
        ;;
    *)
        log_error "Unsupported display manager: $DISPLAY_MANAGER (use one of: $SUPPORTED_DISPLAY_MANAGERS)"

        exit 1
esac
